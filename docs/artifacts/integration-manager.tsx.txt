import React, { useState } from 'react';
import { Cloud, Users, Calendar, FileText, MapPin, Smartphone, Lock, CheckCircle, XCircle, RefreshCw, Zap } from 'lucide-react';

const IntegrationManager = () => {
  const [integrations, setIntegrations] = useState({
    contacts: { enabled: false, status: 'disconnected', lastSync: null, dataCount: 0 },
    calendar: { enabled: false, status: 'disconnected', lastSync: null, dataCount: 0 },
    drive: { enabled: false, status: 'disconnected', lastSync: null, dataCount: 0 },
    location: { enabled: false, status: 'disconnected', lastSync: null, dataCount: 0 },
    phone_calls: { enabled: false, status: 'disconnected', lastSync: null, dataCount: 0 },
  });

  const [syncing, setSyncing] = useState(null);
  const [dynamicQuestions, setDynamicQuestions] = useState([]);
  const [privacyMode, setPrivacyMode] = useState('strict');

  // Sample data for demonstration
  const sampleContacts = [
    { name: 'Sarah Martinez', company: 'TechCorp', callCount: 12, lastContact: '2 days ago' },
    { name: 'John Doe', company: 'StartupXYZ', callCount: 3, lastContact: '1 week ago' },
    { name: 'Emily Chen', company: 'Design Studio', callCount: 8, lastContact: '3 days ago' },
  ];

  const sampleEvents = [
    { title: 'Team Standup', time: '09:00 AM', recurring: 'Daily', attendees: ['Sarah', 'John'] },
    { title: 'Q4 Strategy Meeting', time: '02:00 PM', recurring: 'Weekly', attendees: ['Emily', 'Team'] },
    { title: 'Client Call', time: '11:00 AM', recurring: 'One-time', attendees: ['External'] },
  ];

  const sampleFiles = [
    { name: 'Q4 Marketing Strategy', type: 'PDF', lastAccess: 'Today', accessCount: 15 },
    { name: 'Budget 2026', type: 'Spreadsheet', lastAccess: 'Yesterday', accessCount: 8 },
    { name: 'Personal Goals', type: 'Document', lastAccess: '3 days ago', accessCount: 5 },
  ];

  const integrationDetails = {
    contacts: {
      name: 'Phone Contacts',
      icon: Users,
      color: 'blue',
      description: 'Sync contacts to generate relationship questions',
      permissions: ['Read contacts', 'Basic info only'],
      dataUsed: ['Name', 'Company', 'Last contact date'],
      notStored: ['Phone numbers', 'Email addresses', 'Photos'],
      sampleQuestions: [
        'How do you feel about Sarah Martinez?',
        'You call Sarah 12x/month but John only 3x. Why?',
        'Best way to communicate with Emily Chen?'
      ]
    },
    phone_calls: {
      name: 'Call History',
      icon: Smartphone,
      color: 'green',
      description: 'Analyze call patterns for relationship insights',
      permissions: ['Read call log', 'No call content access'],
      dataUsed: ['Call frequency', 'Duration', 'Time patterns'],
      notStored: ['Call recordings', 'Phone numbers'],
      sampleQuestions: [
        'You always call Sarah at 10 AM. Is this your preferred time?',
        'Average call with John: 45 minutes. This feels right?',
        'You declined 3 calls from Emily this week. Why?'
      ]
    },
    calendar: {
      name: 'Google Calendar',
      icon: Calendar,
      color: 'purple',
      description: 'Learn time preferences and meeting patterns',
      permissions: ['Read calendar events', 'No private details'],
      dataUsed: ['Event titles', 'Time slots', 'Attendees', 'Frequency'],
      notStored: ['Event descriptions', 'Private notes', 'Attachments'],
      sampleQuestions: [
        'Team Standup at 9 AM daily - this time works for you?',
        'Is "Q4 Strategy Meeting" valuable to you?',
        'Meetings with Emily: one-on-one or group?'
      ]
    },
    drive: {
      name: 'Google Drive',
      icon: FileText,
      color: 'orange',
      description: 'Understand project priorities from file access',
      permissions: ['Read file metadata', 'No file contents'],
      dataUsed: ['File names', 'Access frequency', 'Last modified', 'Shared with'],
      notStored: ['File contents', 'Comments', 'Version history'],
      sampleQuestions: [
        'How important is "Q4 Marketing Strategy" right now?',
        'You spent 20 hours on "Budget 2026". Worth it?',
        'Working with Sarah on this file - collaboration style?'
      ]
    },
    location: {
      name: 'Location (Optional)',
      icon: MapPin,
      color: 'red',
      description: 'Learn environment preferences (privacy sensitive)',
      permissions: ['Access general location', 'No precise tracking'],
      dataUsed: ['Named places only', 'Visit frequency', 'Duration'],
      notStored: ['GPS coordinates', 'Movement paths', 'Precise timestamps'],
      sampleQuestions: [
        'You work from home 80% of the time. Ideal for you?',
        'Best environment for creative work?',
        'Office visits decreased this month. Intentional?'
      ]
    }
  };

  const handleConnect = async (integrationType) => {
    setSyncing(integrationType);

    // Simulate connection and sync
    await new Promise(resolve => setTimeout(resolve, 2000));

    const counts = {
      contacts: 47,
      phone_calls: 156,
      calendar: 23,
      drive: 89,
      location: 5
    };

    setIntegrations(prev => ({
      ...prev,
      [integrationType]: {
        enabled: true,
        status: 'connected',
        lastSync: new Date(),
        dataCount: counts[integrationType]
      }
    }));

    setSyncing(null);

    // Generate sample dynamic questions
    generateDynamicQuestions(integrationType);
  };

  const handleDisconnect = (integrationType) => {
    setIntegrations(prev => ({
      ...prev,
      [integrationType]: {
        enabled: false,
        status: 'disconnected',
        lastSync: null,
        dataCount: 0
      }
    }));

    // Remove questions from this source
    setDynamicQuestions(prev =>
      prev.filter(q => q.source !== integrationType)
    );
  };

  const generateDynamicQuestions = (source) => {
    const newQuestions = integrationDetails[source].sampleQuestions.map((q, idx) => ({
      id: `${source}_${idx}`,
      text: q,
      source,
      generated: new Date(),
      priority: Math.random() > 0.5 ? 'high' : 'medium'
    }));

    setDynamicQuestions(prev => [...prev, ...newQuestions]);
  };

  const syncAll = async () => {
    for (const [key, value] of Object.entries(integrations)) {
      if (value.enabled) {
        setSyncing(key);
        await new Promise(resolve => setTimeout(resolve, 1000));

        setIntegrations(prev => ({
          ...prev,
          [key]: { ...prev[key], lastSync: new Date() }
        }));
      }
    }
    setSyncing(null);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white p-6">
      <div className="max-w-7xl mx-auto">
        {/* Header */}
        <div className="flex items-center justify-between mb-8">
          <div>
            <div className="flex items-center gap-3 mb-2">
              <Cloud className="w-10 h-10 text-blue-400" />
              <h1 className="text-4xl font-bold">Integration Manager</h1>
            </div>
            <p className="text-slate-300">Connect your real life to generate personalized questions</p>
          </div>

          <button
            onClick={syncAll}
            disabled={syncing !== null}
            className="bg-blue-600 hover:bg-blue-700 disabled:opacity-50 px-6 py-3 rounded-lg font-semibold flex items-center gap-2"
          >
            <RefreshCw className={`w-5 h-5 ${syncing ? 'animate-spin' : ''}`} />
            Sync All
          </button>
        </div>

        {/* Privacy Mode */}
        <div className="bg-slate-800 rounded-xl p-6 mb-8">
          <div className="flex items-center gap-3 mb-4">
            <Lock className="w-6 h-6 text-green-400" />
            <h2 className="text-2xl font-bold">Privacy Controls</h2>
          </div>

          <div className="grid grid-cols-3 gap-4">
            <button
              onClick={() => setPrivacyMode('strict')}
              className={`p-4 rounded-lg border-2 ${
                privacyMode === 'strict'
                  ? 'border-green-500 bg-green-500/20'
                  : 'border-slate-600 bg-slate-700'
              }`}
            >
              <div className="font-bold mb-2">Strict (Recommended)</div>
              <div className="text-sm text-slate-300">Names only, no identifying info stored</div>
            </button>

            <button
              onClick={() => setPrivacyMode('balanced')}
              className={`p-4 rounded-lg border-2 ${
                privacyMode === 'balanced'
                  ? 'border-blue-500 bg-blue-500/20'
                  : 'border-slate-600 bg-slate-700'
              }`}
            >
              <div className="font-bold mb-2">Balanced</div>
              <div className="text-sm text-slate-300">Basic metadata for better questions</div>
            </button>

            <button
              onClick={() => setPrivacyMode('full')}
              className={`p-4 rounded-lg border-2 ${
                privacyMode === 'full'
                  ? 'border-orange-500 bg-orange-500/20'
                  : 'border-slate-600 bg-slate-700'
              }`}
            >
              <div className="font-bold mb-2">Full Access</div>
              <div className="text-sm text-slate-300">All data for maximum personalization</div>
            </button>
          </div>
        </div>

        {/* Integration Cards */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
          {Object.entries(integrationDetails).map(([key, details]) => {
            const Icon = details.icon;
            const integration = integrations[key];
            const isConnected = integration.enabled;

            return (
              <div key={key} className="bg-slate-800 rounded-xl p-6 border-2 border-slate-700 hover:border-slate-600 transition-all">
                <div className="flex items-start justify-between mb-4">
                  <div className="flex items-center gap-3">
                    <div className={`p-3 rounded-lg bg-${details.color}-500/20`}>
                      <Icon className={`w-6 h-6 text-${details.color}-400`} />
                    </div>
                    <div>
                      <h3 className="text-xl font-bold">{details.name}</h3>
                      <p className="text-sm text-slate-400">{details.description}</p>
                    </div>
                  </div>

                  {isConnected ? (
                    <CheckCircle className="w-6 h-6 text-green-400" />
                  ) : (
                    <XCircle className="w-6 h-6 text-slate-600" />
                  )}
                </div>

                {/* Status */}
                <div className="mb-4">
                  <div className="text-sm text-slate-400 mb-2">Status</div>
                  <div className="flex items-center gap-2">
                    <div className={`w-2 h-2 rounded-full ${
                      isConnected ? 'bg-green-400' : 'bg-slate-600'
                    }`} />
                    <span className="capitalize">{integration.status}</span>
                    {isConnected && (
                      <span className="text-slate-400 ml-2">
                        • {integration.dataCount} items synced
                      </span>
                    )}
                  </div>
                  {integration.lastSync && (
                    <div className="text-xs text-slate-500 mt-1">
                      Last sync: {integration.lastSync.toLocaleTimeString()}
                    </div>
                  )}
                </div>

                {/* Permissions */}
                <div className="mb-4">
                  <div className="text-sm font-semibold mb-2">Permissions Required:</div>
                  <div className="space-y-1">
                    {details.permissions.map((perm, idx) => (
                      <div key={idx} className="text-xs text-slate-400 flex items-center gap-2">
                        <div className="w-1 h-1 rounded-full bg-slate-600" />
                        {perm}
                      </div>
                    ))}
                  </div>
                </div>

                {/* Data Usage */}
                <div className="mb-4">
                  <div className="text-sm font-semibold mb-2 text-green-400">What we use:</div>
                  <div className="text-xs text-slate-400">{details.dataUsed.join(', ')}</div>

                  <div className="text-sm font-semibold mb-2 mt-2 text-red-400">Never stored:</div>
                  <div className="text-xs text-slate-400">{details.notStored.join(', ')}</div>
                </div>

                {/* Sample Questions */}
                {isConnected && (
                  <div className="mb-4 bg-slate-700/50 p-3 rounded">
                    <div className="text-sm font-semibold mb-2">Sample Questions Generated:</div>
                    <div className="space-y-1">
                      {details.sampleQuestions.slice(0, 2).map((q, idx) => (
                        <div key={idx} className="text-xs text-slate-300 italic">
                          "{q}"
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {/* Action Button */}
                <button
                  onClick={() => isConnected ? handleDisconnect(key) : handleConnect(key)}
                  disabled={syncing === key}
                  className={`w-full py-3 rounded-lg font-semibold flex items-center justify-center gap-2 ${
                    isConnected
                      ? 'bg-red-600 hover:bg-red-700'
                      : 'bg-blue-600 hover:bg-blue-700'
                  } disabled:opacity-50 transition-all`}
                >
                  {syncing === key ? (
                    <>
                      <RefreshCw className="w-4 h-4 animate-spin" />
                      Connecting...
                    </>
                  ) : isConnected ? (
                    'Disconnect'
                  ) : (
                    'Connect'
                  )}
                </button>
              </div>
            );
          })}
        </div>

        {/* Generated Questions Preview */}
        {dynamicQuestions.length > 0 && (
          <div className="bg-slate-800 rounded-xl p-6">
            <div className="flex items-center gap-3 mb-4">
              <Zap className="w-6 h-6 text-yellow-400" />
              <h2 className="text-2xl font-bold">Dynamic Questions Generated</h2>
              <span className="text-slate-400">({dynamicQuestions.length} total)</span>
            </div>

            <div className="grid grid-cols-1 gap-3">
              {dynamicQuestions.slice(0, 8).map(q => (
                <div key={q.id} className="bg-slate-700 p-4 rounded-lg">
                  <div className="flex items-start justify-between">
                    <div className="flex-1">
                      <div className="font-semibold mb-1">{q.text}</div>
                      <div className="flex items-center gap-3 text-xs text-slate-400">
                        <span className="capitalize">Source: {q.source.replace('_', ' ')}</span>
                        <span>•</span>
                        <span>Priority: {q.priority}</span>
                        <span>•</span>
                        <span>Generated: {q.generated.toLocaleTimeString()}</span>
                      </div>
                    </div>
                    <span className={`px-3 py-1 rounded text-xs font-bold ${
                      q.priority === 'high' ? 'bg-orange-500/20 text-orange-400' : 'bg-blue-500/20 text-blue-400'
                    }`}>
                      {q.priority}
                    </span>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Sample Data Preview */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
          {/* Contacts Preview */}
          {integrations.contacts.enabled && (
            <div className="bg-slate-800 rounded-xl p-6">
              <h3 className="font-bold mb-4">Synced Contacts</h3>
              <div className="space-y-2">
                {sampleContacts.map((c, idx) => (
                  <div key={idx} className="bg-slate-700 p-3 rounded text-sm">
                    <div className="font-semibold">{c.name}</div>
                    <div className="text-xs text-slate-400">{c.company}</div>
                    <div className="text-xs text-slate-500 mt-1">
                      {c.callCount} calls • Last: {c.lastContact}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* Calendar Preview */}
          {integrations.calendar.enabled && (
            <div className="bg-slate-800 rounded-xl p-6">
              <h3 className="font-bold mb-4">Upcoming Events</h3>
              <div className="space-y-2">
                {sampleEvents.map((e, idx) => (
                  <div key={idx} className="bg-slate-700 p-3 rounded text-sm">
                    <div className="font-semibold">{e.title}</div>
                    <div className="text-xs text-slate-400">{e.time} • {e.recurring}</div>
                    <div className="text-xs text-slate-500 mt-1">
                      With: {e.attendees.join(', ')}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* Drive Preview */}
          {integrations.drive.enabled && (
            <div className="bg-slate-800 rounded-xl p-6">
              <h3 className="font-bold mb-4">Recent Files</h3>
              <div className="space-y-2">
                {sampleFiles.map((f, idx) => (
                  <div key={idx} className="bg-slate-700 p-3 rounded text-sm">
                    <div className="font-semibold">{f.name}</div>
                    <div className="text-xs text-slate-400">{f.type}</div>
                    <div className="text-xs text-slate-500 mt-1">
                      {f.accessCount} views • {f.lastAccess}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default IntegrationManager;